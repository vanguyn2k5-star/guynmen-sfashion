<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GUYN - Sản Phẩm Yêu Thích</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .product-card {
      border-radius: 1rem;
      border: 1px solid #e5e7eb;
      background: linear-gradient(135deg,#ffffff,#f9fafb);
      box-shadow: 0 8px 24px rgba(15,23,42,0.08);
      transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
      overflow: hidden;
      position: relative;
    }
    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 50px rgba(15,23,42,0.18);
      border-color: rgba(248,113,113,0.9);
    }
    .product-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(248,113,113,0.08), transparent 55%);
      opacity: 0;
      transition: opacity 0.25s ease;
      pointer-events: none;
    }
    .product-card:hover::after { opacity: 1; }
    .line-clamp-2 { overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
    .fade-out { animation: fadeOut 0.25s ease forwards; }
    @keyframes fadeOut { to { opacity:0; transform:translateY(10px); } }
    .wishlist-heart {
      transition: transform 0.2s ease, color 0.2s ease;
    }
    .wishlist-heart.removed {
      color:#9ca3af;
      transform: scale(0.8);
    }
    .main-nav .nav-link {
      position: relative;
      padding-bottom: 0.15rem;
      color: #4b5563;
      transition: color 0.18s ease, transform 0.12s ease;
    }
    .main-nav .nav-link::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 2px;
      border-radius: 999px;
      background-image: linear-gradient(90deg, #111827, #b91c1c);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.22s ease;
    }
    .main-nav .nav-link:hover {
      color: #111827;
    }
    .main-nav .nav-link:hover::after {
      transform: scaleX(1);
    }
    .main-nav .nav-link:active {
      transform: translateY(1px) scale(0.98);
    }
    .main-nav .nav-link-active {
      color: #111827;
    }
    .main-nav .nav-link-active::after {
      transform: scaleX(1);
    }
  </style>
  <!-- Đồng bộ font Inter & header từ các trang khác -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      color: #111827;
    }
  </style>
</head>
<body class="bg-gray-50">
  <header class="sticky top-0 z-40 bg-white/95 backdrop-blur border-b border-gray-200">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between gap-6">
      <a href="index.html" class="flex items-center gap-2">
        <img src="images/logo.png" alt="GUYN" class="h-9">
        <span class="hidden sm:block text-sm font-semibold tracking-[0.14em] uppercase text-gray-900">GUYN Men's Fashion</span>
      </a>
      <nav class="hidden md:flex items-center gap-6 main-nav text-[11px] font-medium tracking-[0.14em] uppercase">
        <a href="index.html" class="nav-link">Trang chủ</a>
        <a href="sanpham.html" class="nav-link">Sản phẩm</a>
        <a href="bosuutap.html" class="nav-link">Bộ sưu tập</a>
        <a href="yeu-thich.html" class="nav-link nav-link-active flex items-center gap-1"><i class="far fa-heart"></i> Yêu thích</a>
      </nav>
    </div>
  </header>

  <main class="py-10">
    <section class="container mx-auto px-4 max-w-5xl mb-6">
      <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-1">Danh sách sản phẩm yêu thích</h1>
      <p class="text-sm text-gray-600">
        Những sản phẩm bạn đã bấm trái tim ở trang <strong>Sản phẩm</strong> sẽ được lưu lại tại đây trên trình duyệt của bạn.
      </p>
    </section>

    <section class="container mx-auto px-4 max-w-5xl">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <i class="far fa-heart text-red-500"></i> Sản phẩm bạn đã yêu thích
        </h2>
        <button id="btn-clear-favorites" class="text-xs text-gray-500 hover:text-red-600 flex items-center gap-1 hidden">
          <i class="far fa-trash-alt"></i> Xóa tất cả
        </button>
      </div>

      <div id="favorites-empty" class="bg-white rounded-2xl shadow-md p-6 text-sm text-gray-700 hidden">
        <p class="mb-3">Hiện tại bạn chưa lưu sản phẩm yêu thích nào.</p>
        <p class="text-xs text-gray-500 mb-4">
          Hãy quay lại trang sản phẩm và bấm vào biểu tượng trái tim ở góc trên mỗi sản phẩm để thêm vào danh sách yêu thích.
        </p>
        <a href="sanpham.html" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-red-600 text-white text-xs font-semibold hover:bg-red-700">
          <i class="fas fa-shirt"></i>
          Đi xem sản phẩm để thêm vào Yêu thích
        </a>
      </div>

      <div id="favorites-loading" class="bg-white rounded-2xl shadow-md p-6 text-sm text-gray-600">
        Đang tải danh sách yêu thích...
      </div>

      <div id="favorites-list" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>

      <div id="suggest-section" class="mt-10 hidden">
        <h2 class="text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2">
          <i class="fas fa-wand-magic-sparkles text-purple-500"></i>
          Có thể bạn cũng thích
        </h2>
        <div id="suggest-list" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs"></div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-900 text-gray-300 py-8 text-xs mt-10">
    <div class="container mx-auto px-4 flex flex-col md:flex-row items-center justify-between gap-3">
      <p>© 2025 GUYN Men's Fashion</p>
      <p class="text-gray-500">Yêu thích là danh sách cá nhân trên trình duyệt của bạn.</p>
    </div>
  </footer>
  <!-- Dùng dữ liệu tĩnh từ product.js + localStorage, không cần backend -->
  <script src="js/product.js"></script>
  <script>
    function getFavorites(){
      try { return JSON.parse(localStorage.getItem('favorites') || '[]'); }
      catch { return []; }
    }

    function setFavorites(ids){
      localStorage.setItem('favorites', JSON.stringify(ids));
    }

    function removeFavorite(id){
      const ids = getFavorites().filter(x => x !== id);
      setFavorites(ids);
      const card = document.querySelector(`[data-product-id="${id}"]`);
      if(card){
        card.classList.add('fade-out');
        setTimeout(()=>{
          card.remove();
          if(!document.querySelector('#favorites-list').children.length){
            document.getElementById('favorites-empty').classList.remove('hidden');
            document.getElementById('btn-clear-favorites').classList.add('hidden');
          }
        },220);
      }
    }

    function addToCartFromWishlist(product){
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const sizes = Array.isArray(product.size) ? product.size : (product.size ? String(product.size).split(',') : ['F']);
      const colors = Array.isArray(product.color) ? product.color : (product.color ? String(product.color).split(',') : ['Default']);
      const chosenSize = sizes[0];
      const chosenColor = colors[0];
      const existing = cart.find(i => i.id === product.id && i.size === chosenSize && i.color === chosenColor);
      if(existing) existing.quantity += 1; else cart.push({ id:product.id, name:product.name, price:product.price, image:product.image, size:chosenSize, color:chosenColor, quantity:1 });
      localStorage.setItem('cart', JSON.stringify(cart));
      alert('Đã thêm vào giỏ hàng');
    }

    function loadFavoriteProducts() {
      const emptyBlock = document.getElementById('favorites-empty');
      const loadingBlock = document.getElementById('favorites-loading');
      const listBlock = document.getElementById('favorites-list');
      const clearBtn = document.getElementById('btn-clear-favorites');
      const suggestSection = document.getElementById('suggest-section');
      const suggestList = document.getElementById('suggest-list');

      let favoriteIds = getFavorites();

      if (!favoriteIds.length) {
        loadingBlock.classList.add('hidden');
        emptyBlock.classList.remove('hidden');
        clearBtn.classList.add('hidden');
        return;
      }

      try {
        const all = window.products || [];
        const favProducts = all.filter(p => favoriteIds.includes(p.id));

        loadingBlock.classList.add('hidden');

        if (!favProducts.length) {
          emptyBlock.classList.remove('hidden');
          clearBtn.classList.add('hidden');
          return;
        }

        clearBtn.classList.remove('hidden');

        listBlock.innerHTML = favProducts.map(p => {
          const rating = (4 + Math.random() * 1).toFixed(1);
          const sold = Math.floor(20 + Math.random() * 180);
          const isHot = p.discount >= 30 || (p.originalPrice && (p.originalPrice - p.price) > 200000);
          const tag = isHot ? "HOT MEN'S PICK" : (p.discount > 0 ? 'Giảm giá' : 'New Arrival');
          const modelInfo = p.modelInfo || 'Model: 177cm / 68kg - M size';
          const sizeHint = p.sizeHint || 'Gợi ý size của bạn: M (1m7 - 1m75)';
          const styleTag = p.styleTag || 'Korean Look';
          const sizes = Array.isArray(p.size) ? p.size : (p.size ? String(p.size).split(',') : []);
          const colors = Array.isArray(p.color) ? p.color : (p.color ? String(p.color).split(',') : []);
          const inStock = p.stock === undefined ? true : p.stock > 0;
          return `
            <div class="product-card group" data-product-id="${p.id}">
              <div class="absolute top-2 left-2 z-10 flex items-center gap-1 text-[10px] font-semibold text-white">
                <span class="px-2 py-0.5 rounded bg-red-600/90">GUYN Mall</span>
                <span class="px-2 py-0.5 rounded bg-pink-500/90 hidden sm:inline">Yêu thích+</span>
              </div>
              <button class="absolute top-2 right-2 z-10 text-white/90 hover:text-red-300 wishlist-heart" onclick="event.stopPropagation(); removeFavorite(${p.id});">
                <i class="fas fa-heart"></i>
              </button>
              ${p.discount > 0 ? `<span class="absolute top-2 right-9 bg-red-600 text-white text-[11px] px-2 py-1 rounded shadow-sm">-${p.discount}%</span>` : ''}
              <div class="relative w-full h-52 overflow-hidden">
                <a href="chitietsp.html?id=${p.id}">
                  <img src="${p.image}" alt="${p.name}" class="w-full h-52 object-cover transition-opacity duration-300 group-hover:opacity-0">
                  <img src="${(p.previewImages && p.previewImages[1]) || p.image}" alt="${p.name} model" class="absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                </a>
              </div>
              <div class="p-3.5 relative z-10 bg-white/90">
                <h3 class="text-xs md:text-sm font-medium line-clamp-2 mb-1.5 text-gray-900">${p.name}</h3>
                <div class="flex items-baseline justify-between gap-2 mb-1">
                  <div class="flex items-end gap-1">
                    <span class="text-red-600 font-bold text-sm md:text-base">${p.price.toLocaleString()}đ</span>
                    ${p.originalPrice > p.price ? `<span class="text-[11px] text-gray-400 line-through">${p.originalPrice.toLocaleString()}đ</span>` : ''}
                  </div>
                  <span class="text-[10px] px-2 py-1 rounded bg-yellow-50 text-yellow-700 border border-yellow-200">${tag}</span>
                </div>
                <div class="flex items-center justify-between text-[10px] text-gray-500 mb-1">
                  <span class="px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-700 border border-gray-200">${styleTag}</span>
                  <span class="px-1.5 py-0.5 rounded-full bg-gray-100 text-gray-700 border border-gray-200 hidden sm:inline">FORM SLIM / OVERSIZE</span>
                </div>
                <div class="flex items-center justify-between text-[11px] text-gray-500 mb-1">
                  <div class="flex items-center gap-1">
                    <i class="fas fa-star text-yellow-400 text-[10px]"></i>
                    <span class="font-semibold text-gray-700">${rating}</span>
                  </div>
                  <span>Đã bán ${sold}+</span>
                </div>
                <div class="flex items-center justify-between text-[11px]">
                  <span class="flex items-center gap-1 text-green-600"><i class="fas fa-truck-fast text-[10px]"></i> Freeship từ 299k</span>
                  <span class="px-1.5 py-0.5 rounded bg-gray-100 text-gray-600 max-w-[80px] truncate text-right">${p.category || ''}</span>
                </div>
                <div class="mt-1 text-[10px] text-gray-500 flex justify-between">
                  <span>${modelInfo}</span>
                </div>
                <div class="text-[10px] text-blue-600 mt-0.5 mb-1">${sizeHint}</div>
                <div class="flex items-center justify-between text-[10px] text-gray-600 mb-2">
                  <span>Size: ${sizes.length ? sizes.join(', ') : 'Freesize'}</span>
                  <span>Màu: ${colors.length ? colors.join(', ') : 'Ngẫu nhiên'}</span>
                </div>
                <div class="flex items-center justify-between text-[10px] mb-2">
                  <span class="flex items-center gap-1 ${inStock ? 'text-emerald-600' : 'text-red-500'}">
                    <i class="fas ${inStock ? 'fa-circle-check' : 'fa-circle-xmark'} text-[10px]"></i>
                    ${inStock ? 'Còn hàng' : 'Hết hàng'}</span>
                  <button class="underline text-gray-500 hover:text-gray-700" onclick="event.stopPropagation(); alert('Khi back-end có, sẽ gửi thông báo khi sản phẩm có lại hoặc có khuyến mãi.');">Nhận thông báo</button>
                </div>
                <div class="flex items-center gap-2 mt-1">
                  <button class="flex-1 inline-flex items-center justify-center gap-1.5 text-[11px] font-semibold px-2.5 py-1.5 rounded-full bg-gray-900 text-white hover:bg-gray-800" onclick="event.stopPropagation(); addToCartFromWishlist(${JSON.stringify({id:'ID_PLACEHOLDER'})});">
                    <i class="fas fa-cart-plus text-[10px]"></i> Thêm vào giỏ
                  </button>
                  <button class="px-2 py-1 text-[10px] rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100" onclick="event.stopPropagation(); removeFavorite(${p.id});">Xóa</button>
                </div>
              </div>
            </div>
          `;
        }).join('');

        // Gợi ý sản phẩm tương tự theo category
        const categories = [...new Set(favProducts.map(p => p.category).filter(Boolean))];
        const suggest = all.filter(p => !favoriteIds.includes(p.id) && categories.includes(p.category)).slice(0,8);
        if(suggest.length){
          suggestSection.classList.remove('hidden');
          suggestList.innerHTML = suggest.map(p => `
            <a href="chitietsp.html?id=${p.id}" class="block bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow duration-150 overflow-hidden">
              <img src="${p.image}" alt="${p.name}" class="w-full h-28 object-cover">
              <div class="p-2">
                <div class="line-clamp-2 mb-1">${p.name}</div>
                <div class="text-red-600 font-semibold text-[11px]">${p.price.toLocaleString()}đ</div>
              </div>
            </a>
          `).join('');
        }
      } catch (e) {
        console.error(e);
        loadingBlock.textContent = 'Lỗi: Không thể tải dữ liệu sản phẩm yêu thích.';
      }
    }

    window.addEventListener('DOMContentLoaded', loadFavoriteProducts);

    document.getElementById('btn-clear-favorites').addEventListener('click', () => {
      if(!confirm('Bạn có chắc muốn xóa toàn bộ danh sách yêu thích?')) return;
      setFavorites([]);
      document.getElementById('favorites-list').innerHTML = '';
      document.getElementById('favorites-empty').classList.remove('hidden');
      document.getElementById('btn-clear-favorites').classList.add('hidden');
    });
  </script>
</body>
</html>
